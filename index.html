<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dados de Monedas y Billetes (CLP) ‚Äì Sin total</title>
<style>
  :root{
    --bg: #0b1020; --card: #141a2e; --muted: #8ea0b8; --accent: #6ee7ff;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
    color:#eef3ff; background: radial-gradient(1200px 800px at 20% -10%, #1a2350 0%, var(--bg) 45%), linear-gradient(160deg,#0a0f23,#0a0f23);} 
  .wrap{max-width:1100px; margin:0 auto; padding:24px}
  header{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:18px}
  h1{font-size:clamp(20px,3.5vw,28px); margin:0; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:14px}
  .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end}
  .btn{border:1px solid #2c355b; background:#101736; color:#e7f2ff; padding:10px 14px; border-radius:14px; font-weight:600; cursor:pointer; transition:.2s}
  .btn:hover{transform: translateY(-1px); border-color:#3b4b86; background:#0f1b47}
  .btn.primary{background: linear-gradient(180deg,#1c85f4,#1561e0); border-color:#0e49b7}
  .toggle{display:flex; align-items:center; gap:8px; font-size:14px; color:var(--muted)}
  .toggle input{accent-color:#1ea7ff; width:18px; height:18px}
  .board{display:grid; grid-template-columns: 1fr; gap:16px;}
  @media(min-width:800px){ .board{ grid-template-columns: 1.3fr .7fr; } }
  .dice-area{display:grid; grid-template-columns: 1fr 1fr; gap:16px;}
  .die{position:relative; background: linear-gradient(180deg,#121a3a,#0d1330);
    border:1px solid #2b3259; border-radius:22px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03); overflow:hidden; min-height:280px;}
  .die .tag{position:absolute; top:10px; left:12px; font-size:12px; color:#aebee0; background:#0c1330; padding:6px 10px; border-radius:999px; border:1px solid #33406b;}
  .die-face{display:flex; align-items:center; justify-content:center; height:100%; transition: transform .6s cubic-bezier(.22,1,.36,1);} 
  .rolling .die-face{ transform: rotate3d(1,.5,0, 540deg) scale(1.03); }
  figure.currency{margin:0; display:flex; flex-direction:column; align-items:center; gap:10px; text-align:center;}
  .svg-wrap{ width:min(92%, 360px); aspect-ratio: 16/11; display:flex; align-items:center; justify-content:center}
  .label{font-weight:700; letter-spacing:.3px; background:#0b1435; border:1px solid #313b66; padding:8px 12px; border-radius:999px;}
  .label.muted{ color:#c8d7ff; font-weight:600; }
  .hide-text .label{ filter: blur(10px); }
  .panel{background: linear-gradient(180deg,#111838,#0d1330); border:1px solid #2b3159; border-radius:18px; padding:16px;}
  .list{ margin:0; padding-left:18px; color:#cfe0ff}
  .help{ color:#b9c9e9; font-size:14px; line-height:1.45}
  .kbd{ font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; background:#10182f; border:1px solid #2d3965; padding:2px 6px; border-radius:6px}
  footer{margin-top:18px; color:#9fb1d7; font-size:12px}
  .sr-only{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Dados de Monedas y Billetes (CLP)</h1>
      <div class="sub">Herramienta multisensorial: imagen + audio (sin total).</div>
    </div>
    <div class="controls" role="group" aria-label="Controles">
      <button id="rollBtn" class="btn primary" aria-label="Lanzar dados (barra espaciadora)">üé≤ Lanzar (Espacio)</button>
      <button id="repeatBtn" class="btn" aria-label="Repetir audio de los dados (tecla R)">üîä Repetir</button>
      <label class="toggle"><input type="checkbox" id="muteToggle" /> Silencio</label>
      <label class="toggle"><input type="checkbox" id="hideTextToggle" /> Ocultar texto (modo evaluaci√≥n)</label>
    </div>
  </header>

  <main class="board">
    <section aria-labelledby="diceTitle">
      <h2 id="diceTitle" class="sr-only">Zona de dados</h2>
      <div class="dice-area" id="diceArea">
        <div class="die" id="die1" aria-live="polite" aria-label="Dado 1">
          <span class="tag">Dado 1</span>
          <div class="die-face"><figure class="currency"><div class="svg-wrap"></div><figcaption class="label muted">Listo para lanzar</figcaption></figure></div>
        </div>
        <div class="die" id="die2" aria-live="polite" aria-label="Dado 2">
          <span class="tag">Dado 2</span>
          <div class="die-face"><figure class="currency"><div class="svg-wrap"></div><figcaption class="label muted">Listo para lanzar</figcaption></figure></div>
        </div>
      </div>
    </section>

    <aside class="panel" aria-labelledby="helpTitle">
      <h2 id="helpTitle" style="margin:0 0 8px 0; font-size:18px">Instrucciones r√°pidas</h2>
      <ul class="list">
        <li>Pulsa <span class="kbd">Espacio</span> o ‚ÄúLanzar‚Äù para tirar los 2 dados.</li>
        <li>El sistema nombra en voz alta cada valor y muestra la imagen equivalente.</li>
        <li>‚ÄúOcultar texto‚Äù borra pistas visuales para evaluaci√≥n (el audio se mantiene).</li>
        <li>‚ÄúRepetir‚Äù vuelve a anunciar por voz solo los dos valores.</li>
      </ul>
      <p class="help" style="margin-top:10px">
        Sugerencia: que el estudiante identifique f√≠sicamente cada valor escuchado usando monedas/billetes reales.
      </p>
      <p class="help">
        Accesibilidad: teclado (<span class="kbd">Espacio</span>=Lanzar, <span class="kbd">R</span>=Repetir, <span class="kbd">M</span>=Silencio).
      </p>
    </aside>
  </main>

  <footer>
    Set de valores (CLP): monedas de 10, 50, 100, 500; billetes de 1.000, 2.000, 5.000, 10.000 y 20.000.
  </footer>
</div>

<script>
/* ===========================
   Datos y utilidades
=========================== */
const formatterCLP = new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 });

/** Mapeo a palabras simples para locuci√≥n */
const WORDS = {
  10: "diez", 50: "cincuenta", 100: "cien", 500: "quinientos",
  1000: "mil", 2000: "dos mil", 5000: "cinco mil", 10000: "diez mil", 20000: "veinte mil"
};

const CURRENCY_SET_CLP = [
  { kind:"coin", value:10,  color:"#c9d1d9" },
  { kind:"coin", value:50,  color:"#c9d1d9" },
  { kind:"coin", value:100, color:"#d6b76a" },
  { kind:"coin", value:500, color:"#d6b76a" },
  { kind:"bill", value:1000,  color:"#3bb273" },
  { kind:"bill", value:2000,  color:"#8b6bd6" },
  { kind:"bill", value:5000,  color:"#d46576" },
  { kind:"bill", value:10000, color:"#4b7bd0" },
  { kind:"bill", value:20000, color:"#e0883d" },
];

/* ===========================
   S√≠ntesis de voz (TTS)
=========================== */
let selectedVoice = null;
function pickSpanishVoice(){
  const voices = window.speechSynthesis.getVoices();
  if(!voices || !voices.length) return null;
  const preferOrder = ["CL","419","ES","US","MX","AR","PE","CO"];
  const spanish = voices.filter(v => /(^|\W)es(-|$)/i.test(v.lang) || /spanish/i.test(v.name));
  if(!spanish.length) return voices[0];
  spanish.sort((a,b)=>{
    const ia = preferOrder.findIndex(reg => (a.lang||"").toUpperCase().includes(reg));
    const ib = preferOrder.findIndex(reg => (b.lang||"").toUpperCase().includes(reg));
    return (ia<0?99:ia) - (ib<0?99:ib);
  });
  return spanish[0];
}
function speak(text){
  if(muted) return;
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = (selectedVoice && selectedVoice.lang) || "es-CL";
  if(selectedVoice) msg.voice = selectedVoice;
  msg.rate = 1; msg.pitch = 1; msg.volume = 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(msg);
}

/* ===========================
   Generaci√≥n de SVGs
=========================== */
function svgCoin(label, baseColor){
  const text = label.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  return `
  <svg viewBox="0 0 500 360" role="img" aria-label="Moneda ${label} pesos" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="g1" cx="50%" cy="40%" r="60%">
        <stop offset="0%" stop-color="#ffffff" stop-opacity=".8"/>
        <stop offset="35%" stop-color="${baseColor}" stop-opacity="1"/>
        <stop offset="100%" stop-color="#6b6b6b"/>
      </radialGradient>
      <linearGradient id="edge" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="#fff" stop-opacity=".3"/>
        <stop offset="100%" stop-color="#000" stop-opacity=".3"/>
      </linearGradient>
    </defs>
    <rect x="0" y="0" width="500" height="360" rx="26" fill="none"/>
    <g transform="translate(70,30)">
      <circle cx="180" cy="150" r="140" fill="url(#g1)" stroke="url(#edge)" stroke-width="10"/>
      <circle cx="180" cy="150" r="120" fill="none" stroke="#000" stroke-opacity=".25" stroke-width="3" stroke-dasharray="6 10"/>
      <text x="180" y="160" text-anchor="middle" dominant-baseline="middle" font-size="72" font-weight="800" fill="#0a0a0a">${text}</text>
      <text x="180" y="210" text-anchor="middle" font-size="28" fill="#111">PESOS</text>
    </g>
  </svg>`;
}
function svgBill(label, base){
  const text = label.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  return `
  <svg viewBox="0 0 500 360" role="img" aria-label="Billete ${label} pesos" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="gb" x1="0" x2="1" y1="0" y2="0">
        <stop offset="0%" stop-color="${shade(base, -10)}"/>
        <stop offset="100%" stop-color="${shade(base, 10)}"/>
      </linearGradient>
      <pattern id="dots" patternUnits="userSpaceOnUse" width="16" height="16">
        <circle cx="3" cy="3" r="1.5" fill="#ffffff" opacity=".25"/>
      </pattern>
    </defs>
    <g transform="translate(20,40)">
      <rect width="460" height="280" rx="22" fill="url(#gb)" stroke="#ffffff22" stroke-width="2"/>
      <rect x="220" y="20" width="30" height="240" fill="#ffffff" opacity=".25"/>
      <rect x="20" y="20" width="140" height="70" rx="10" fill="#00000017" />
      <rect x="300" y="190" width="140" height="70" rx="10" fill="#00000017" />
      <rect width="460" height="280" rx="22" fill="url(#dots)" opacity=".25"/>
      <text x="50" y="68" font-size="28" font-weight="700" fill="#fff">${formatterCLP.format(label)}</text>
      <text x="230" y="160" text-anchor="middle" dominant-baseline="middle" font-size="64" font-weight="800" fill="#fff">${text}</text>
    </g>
  </svg>`;
}
function shade(hex, percent){
  const c = hex.replace('#',''); const n = parseInt(c,16);
  let r = (n >> 16) & 255, g = (n >> 8) & 255, b = n & 255;
  r = Math.min(255, Math.max(0, Math.round(r + (percent/100)*255)));
  g = Math.min(255, Math.max(0, Math.round(g + (percent/100)*255)));
  b = Math.min(255, Math.max(0, Math.round(b + (percent/100)*255)));
  return '#' + ((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1);
}

/* ===========================
   L√≥gica de los dados
=========================== */
const dieEls = [document.getElementById('die1'), document.getElementById('die2')];
const rollBtn = document.getElementById('rollBtn');
const repeatBtn = document.getElementById('repeatBtn');
const muteToggle = document.getElementById('muteToggle');
const hideTextToggle = document.getElementById('hideTextToggle');
let lastResults = [null,null];
let muted = false;

function pickRandom(){
  return CURRENCY_SET_CLP[Math.floor(Math.random()*CURRENCY_SET_CLP.length)];
}
function renderDie(el, item, hideText=false){
  const fig = el.querySelector('figure.currency');
  const svgWrap = fig.querySelector('.svg-wrap');
  const caption = fig.querySelector('.label');
  const isCoin = item.kind === "coin";
  const svg = isCoin ? svgCoin(item.value, item.color) : svgBill(item.value, item.color);
  svgWrap.innerHTML = svg;
  caption.textContent = (isCoin ? "Moneda" : "Billete") + " " + formatterCLP.format(item.value);
  if(hideText){ fig.classList.add('hide-text'); } else { fig.classList.remove('hide-text'); }
  el.setAttribute('aria-label', `${isCoin?"Moneda":"Billete"} de ${item.value} pesos`);
}
function roll(){
  dieEls.forEach(el => el.classList.add('rolling'));
  const hide = hideTextToggle.checked;
  setTimeout(()=>{
    lastResults = [pickRandom(), pickRandom()];
    renderDie(dieEls[0], lastResults[0], hide);
    renderDie(dieEls[1], lastResults[1], hide);
    dieEls.forEach(el => el.classList.remove('rolling'));
    announceValuesOnly();
  }, 650);
}
function announceValuesOnly(){
  if(muted) return;
  if(!lastResults[0] || !lastResults[1]) return;
  const parts = lastResults.map(it => `${it.kind==="coin"?"Moneda":"Billete"} de ${WORDS[it.value] || it.value} pesos`);
  const phrase = `${parts[0]}. ${parts[1]}.`;
  speak(phrase);
}

/* ===========================
   Eventos UI y accesibilidad
=========================== */
rollBtn.addEventListener('click', roll);
repeatBtn.addEventListener('click', announceValuesOnly);
muteToggle.addEventListener('change', e => { muted = !!e.target.checked; });
hideTextToggle.addEventListener('change', ()=>{
  if(lastResults[0] && lastResults[1]){
    renderDie(dieEls[0], lastResults[0], hideTextToggle.checked);
    renderDie(dieEls[1], lastResults[1], hideTextToggle.checked);
  }
});
document.addEventListener('keydown', (ev)=>{
  if(ev.code === 'Space'){ ev.preventDefault(); roll(); }
  if(ev.key.toLowerCase() === 'r'){ ev.preventDefault(); announceValuesOnly(); }
  if(ev.key.toLowerCase() === 'm'){ ev.preventDefault(); muted = !muted; muteToggle.checked = muted; }
});

/* ===========================
   Inicializaci√≥n de voz
=========================== */
if('speechSynthesis' in window){
  window.speechSynthesis.onvoiceschanged = ()=>{ selectedVoice = pickSpanishVoice(); };
  selectedVoice = pickSpanishVoice();
} else {
  console.warn("Este navegador no soporta s√≠ntesis de voz.");
}

/* Primer render vac√≠o amigable */
dieEls.forEach(el=>{
  const fig = el.querySelector('figure.currency');
  fig.querySelector('.svg-wrap').innerHTML = `
    <svg viewBox="0 0 500 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Esperando lanzamiento">
      <defs><linearGradient id="idle" x1="0" x2="1" y1="0" y2="0">
        <stop offset="0%" stop-color="#1a2455"/><stop offset="100%" stop-color="#0e1639"/></linearGradient></defs>
      <rect x="15" y="15" width="470" height="330" rx="24" fill="url(#idle)" stroke="#ffffff14" />
      <text x="250" y="188" text-anchor="middle" dominant-baseline="middle" font-size="28" fill="#b7c6ee">Pulsa ‚ÄúLanzar‚Äù</text>
    </svg>`;
});
</script>
</body>
</html>
